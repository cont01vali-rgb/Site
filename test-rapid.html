<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Rapid General Test</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 20px; 
      background: #f5f5f5; 
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 800px;
      margin: 0 auto;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button {
      background: #007acc;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #005999;
    }
    .log {
      background: #f8f8f8;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      white-space: pre-wrap;
      max-height: 500px;
      overflow-y: auto;
      margin-top: 15px;
      border: 1px solid #ddd;
    }
    .category-info {
      margin: 10px 0;
      padding: 10px;
      background: #e3f2fd;
      border-radius: 4px;
    }
    .success { color: #2e7d32; font-weight: bold; }
    .error { color: #d32f2f; font-weight: bold; }
    .warning { color: #f57c00; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” Test Rapid - Sistem General Test</h1>
    <p>AceastÄƒ paginÄƒ testeazÄƒ dacÄƒ categoriile lipsÄƒ (<strong>die-zahlen</strong> È™i <strong>das-lernziel</strong>) sunt Ã®ncÄƒrcate corect.</p>
    
    <div>
      <button onclick="testLoadExternalExercises()">1. TesteazÄƒ ÃncÄƒrcarea ExerciÈ›iilor Externe</button>
      <button onclick="testMergeProcess()">2. TesteazÄƒ Procesul de Merge</button>
      <button onclick="forceManualMerge()">2b. ForÈ›eazÄƒ Merge Manual</button>
      <button onclick="testBuildPool()">3. TesteazÄƒ Construirea Pool-ului</button>
      <button onclick="clearLog()">È˜terge Log-ul</button>
    </div>

    <div id="log" class="log">Gata pentru testare...\n</div>
  </div>

  <script src="data/general-exercises.js"></script>
  <script src="js/general-test.js"></script>
  <script>
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const logEl = document.getElementById('log');
      
      let className = '';
      let prefix = '';
      if (type === 'success') {
        className = 'success';
        prefix = 'âœ… ';
      } else if (type === 'error') {
        className = 'error';
        prefix = 'âŒ ';
      } else if (type === 'warning') {
        className = 'warning';
        prefix = 'âš ï¸ ';
      } else {
        prefix = 'â„¹ï¸ ';
      }
      
      const line = `${timestamp}: ${prefix}${message}\n`;
      if (className) {
        logEl.innerHTML += `<span class="${className}">${line}</span>`;
      } else {
        logEl.textContent += line;
      }
      logEl.scrollTop = logEl.scrollHeight;
    }
    
    function clearLog() {
      document.getElementById('log').textContent = 'Log È™ters...\n';
    }
    
    function testLoadExternalExercises() {
      log('=== TESTARE ÃNCÄ‚RCARE EXERCIÈšII EXTERNE ===');
      
      if (window.generalExercises) {
        log('ExerciÈ›iile externe sunt Ã®ncÄƒrcate!', 'success');
        
        const categories = Object.keys(window.generalExercises);
        log(`Categorii disponibile: ${categories.join(', ')}`);
        
        // TesteazÄƒ categoriile specifice
        if (window.generalExercises['die-zahlen']) {
          const zahlenCount = window.generalExercises['die-zahlen'].length;
          log(`âœ“ die-zahlen: ${zahlenCount} exerciÈ›ii`, 'success');
          
          // AratÄƒ primul exerciÈ›iu ca exemplu
          const firstEx = window.generalExercises['die-zahlen'][0];
          log(`  Primul exerciÈ›iu: ${JSON.stringify(firstEx)}`);
        } else {
          log('âœ— die-zahlen: NU GÄ‚SIT!', 'error');
        }
        
        if (window.generalExercises['das-lernziel']) {
          const lernzielCount = window.generalExercises['das-lernziel'].length;
          log(`âœ“ das-lernziel: ${lernzielCount} exerciÈ›ii`, 'success');
          
          // AratÄƒ primul exerciÈ›iu ca exemplu
          const firstEx = window.generalExercises['das-lernziel'][0];
          log(`  Primul exerciÈ›iu: ${JSON.stringify(firstEx)}`);
        } else {
          log('âœ— das-lernziel: NU GÄ‚SIT!', 'error');
        }
        
      } else {
        log('ExerciÈ›iile externe NU sunt Ã®ncÄƒrcate!', 'error');
      }
    }
    
    async function testMergeProcess() {
      log('=== TESTARE PROCES MERGE ===');
      
      if (!window.generalExercises) {
        log('Nu pot testa merge-ul - exerciÈ›iile externe nu sunt Ã®ncÄƒrcate!', 'error');
        return;
      }
      
      // TesteazÄƒ funcÈ›ia de merge manualÄƒ
      if (typeof window.forceTestMerge === 'function') {
        log('Execut merge-ul manual...');
        const result = window.forceTestMerge();
        
        if (result) {
          log('Merge-ul manual a fost executat cu succes!', 'success');
          log('VerificÄƒ Console-ul pentru detalii despre BANK!', 'warning');
        } else {
          log('Merge-ul manual a eÈ™uat!', 'error');
        }
      } else {
        log('FuncÈ›ia forceTestMerge nu este disponibilÄƒ!', 'error');
      }
      
      // ÃncearcÄƒ È™i funcÈ›ia originalÄƒ
      try {
        if (typeof window.waitForExternalExercises === 'function') {
          log('Testez È™i waitForExternalExercises...');
          const result = await window.waitForExternalExercises(1000);
          
          if (result) {
            log('waitForExternalExercises a reuÈ™it!', 'success');
          } else {
            log('waitForExternalExercises a expirat sau a eÈ™uat!', 'warning');
          }
        }
      } catch (error) {
        log(`Eroare cu waitForExternalExercises: ${error.message}`, 'error');
      }
    }
    
    function testBuildPool() {
      log('=== TESTARE CONSTRUIRE POOL ===');
      
      if (typeof window.buildPool === 'function') {
        try {
          log('Construiesc pool-ul...');
          const result = window.buildPool?.();
          
          if (result && result.pool) {
            log(`Pool construit cu succes! Total exerciÈ›ii: ${result.pool.length}`, 'success');
            
            // AnalizeazÄƒ categoriile din pool
            const categoryCounts = {};
            result.pool.forEach(q => {
              categoryCounts[q.cat] = (categoryCounts[q.cat] || 0) + 1;
            });
            
            log('Categorii Ã®n pool:');
            Object.entries(categoryCounts).forEach(([cat, count]) => {
              const isTargetCategory = cat === 'die-zahlen' || cat === 'das-lernziel';
              const type = isTargetCategory ? 'success' : 'info';
              log(`  ${cat}: ${count} exerciÈ›ii`, type);
            });
            
            // VerificÄƒ specific categoriile dorite
            if (categoryCounts['die-zahlen']) {
              log(`âœ“ die-zahlen gÄƒsit Ã®n pool: ${categoryCounts['die-zahlen']} exerciÈ›ii`, 'success');
            } else {
              log('âœ— die-zahlen NU este Ã®n pool!', 'error');
            }
            
            if (categoryCounts['das-lernziel']) {
              log(`âœ“ das-lernziel gÄƒsit Ã®n pool: ${categoryCounts['das-lernziel']} exerciÈ›ii`, 'success');
            } else {
              log('âœ— das-lernziel NU este Ã®n pool!', 'error');
            }
            
          } else {
            log('Pool-ul nu a putut fi construit!', 'error');
          }
          
          log('VerificÄƒ Console-ul Browser-ului pentru log-uri detaliate!', 'warning');
          
        } catch (error) {
          log(`Eroare la construirea pool-ului: ${error.message}`, 'error');
        }
      } else {
        log('FuncÈ›ia buildPool nu este disponibilÄƒ!', 'error');
      }
    }
    
    function forceManualMerge() {
      log('=== MERGE MANUAL FORÈšAT ===');
      
      if (typeof window.forceTestMerge === 'function') {
        log('Execut merge-ul manual...');
        const success = window.forceTestMerge();
        
        if (success) {
          log('âœ… Merge-ul manual a reuÈ™it!', 'success');
          log('Acum testez din nou pool-ul...', 'warning');
          
          // TesteazÄƒ din nou pool-ul
          setTimeout(() => {
            testBuildPool();
          }, 500);
        } else {
          log('âŒ Merge-ul manual a eÈ™uat!', 'error');
        }
      } else {
        log('FuncÈ›ia forceTestMerge nu este disponibilÄƒ!', 'error');
      }
    }
    
    // Auto-testare la Ã®ncÄƒrcare
    setTimeout(() => {
      log('=== AUTO-TEST LA ÃNCÄ‚RCARE ===');
      testLoadExternalExercises();
    }, 500);
  </script>
</body>
</html>